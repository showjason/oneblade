# OneBlade SRE Agent 配置
# 敏感信息请使用环境变量，格式：${VAR} 或 ${VAR:default}

# Agent 配置（严格 per-agent，不支持继承）
# 每个 agent 必须完整定义 required 字段：provider/model
# orchestrator 必须 enabled=true
# 子 agents（service_agent, prediction_agent, report_agent）中至少有一个必须 enabled=true

[agents.orchestrator]
enabled = true
[agents.orchestrator.llm]
provider = "gemini"
model = "${GEMINI_MODEL:gemini-2.5-flash-tts}"
api_key = "${GEMINI_API_KEY}"
base_url = "${OPENAI_BASE_URL:https://api.openai.com/v1}"
timeout = "60s"
max_tokens = 4096
temperature = 0.2

[agents.service_agent]
enabled = true
[agents.service_agent.llm]
provider = "gemini"
model = "${GEMINI_MODEL:gemini-2.5-flash-tts}"
api_key = "${GEMINI_API_KEY}"
base_url = "${OPENAI_BASE_URL:https://api.openai.com/v1}"
timeout = "60s"
max_tokens = 4096
temperature = 0.2

[agents.prediction_agent]
enabled = false
[agents.prediction_agent.llm]
provider = "gemini"
model = "${GEMINI_MODEL:gemini-2.5-flash}"
api_key = "${GEMINI_API_KEY}"
base_url = "${OPENAI_BASE_URL:https://api.openai.com/v1}"
timeout = "60s"
max_tokens = 4096
temperature = 0.2

[agents.report_agent]
enabled = false
[agents.report_agent.llm]
provider = "gemini"
model = "${GEMINI_MODEL:gemini-2.5-flash}"
api_key = "${GEMINI_API_KEY}"
base_url = "${OPENAI_BASE_URL:https://api.openai.com/v1}"
timeout = "60s"
max_tokens = 4096
temperature = 0.2

[server]
addr = ":8080"
timeout = "30s"

[data.database]
driver = "postgres"
source = "${DATABASE_URL:postgres://localhost:5432/oneblade?sslmode=disable}"

[data.redis]
addr = "${REDIS_ADDR:localhost:6379}"
read_timeout = "3s"
write_timeout = "3s"

# Service 配置 - 使用 map 结构，支持动态扩展
[services.prometheus]
type = "prometheus"
enabled = false
[services.prometheus.options]
address = "${PROMETHEUS_URL:http://localhost:9090}"
timeout = "30s"

[services.pagerduty]
type = "pagerduty"
enabled = true
[services.pagerduty.options]
api_key = "${PAGERDUTY_API_KEY}"
# from = "${PAGERDUTY_FROM:}"  # 可选：执行操作的用户 email，用于 PagerDuty API 的 From header

[services.opensearch]
type = "opensearch"
enabled = false
[services.opensearch.options]
addresses = ["${OPENSEARCH_URL:http://localhost:9200}"]
username = "${OPENSEARCH_USER}"
password = "${OPENSEARCH_PASS}"
index = "logs-*"
